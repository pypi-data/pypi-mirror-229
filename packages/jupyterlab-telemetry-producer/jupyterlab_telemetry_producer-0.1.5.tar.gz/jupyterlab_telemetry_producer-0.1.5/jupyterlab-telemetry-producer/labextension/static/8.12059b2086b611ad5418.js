"use strict";(self.webpackChunkjupyterlab_telemetry_producer=self.webpackChunkjupyterlab_telemetry_producer||[]).push([[8],{8:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});var i=n(212),o=n(448),s=n(519),l=n(380);async function c(e="",t={}){const n=l.ServerConnection.makeSettings(),i=s.URLExt.join(n.baseUrl,"jupyterlab-telemetry-producer",e);let o;try{o=await l.ServerConnection.makeRequest(i,t,n)}catch(e){throw new l.ServerConnection.NetworkError(e)}let c=await o.text();if(c.length>0)try{c=JSON.parse(c)}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok)throw new l.ServerConnection.ResponseError(o,c.message||c);return c}class a{constructor(){this.produced=!1}async listen(e,t,n){if(!this.produced){const e={eventName:a.id,eventTime:Date.now(),eventInfo:{environ:await c("environ")}};await t.publishEvent(e,n),this.produced=!0}}}a.id="NotebookOpenEvent";const d=e=>{const t=[];for(let n=0;n<e.content.widgets.length;n++){const i=e.content.widgets[n],o=i.node.offsetTop,s=i.node.offsetTop+i.node.offsetHeight,l=e.content.node.scrollTop;o<=e.content.node.scrollTop+e.content.node.clientHeight&&s>=l&&t.push({id:i.model.id,index:n})}return t};class v{constructor(){this.timeout=0}listen(e,t,n){e.content.node.addEventListener("scroll",(async i=>{i.stopPropagation(),clearTimeout(this.timeout),await new Promise((e=>this.timeout=setTimeout(e,1500)));const o={eventName:v.id,eventTime:Date.now(),eventInfo:{cells:d(e)}};await t.publishEvent(o,n)}))}}v.id="NotebookScrollEvent";class r{listen(e,t,n){document.addEventListener("visibilitychange",(async()=>{if("visible"===document.visibilityState){const i={eventName:r.id,eventTime:Date.now(),eventInfo:{cells:d(e)}};await t.publishEvent(i,n)}}))}}r.id="NotebookVisibleEvent";class u{listen(e,t,n){document.addEventListener("visibilitychange",(async e=>{if("hidden"===document.visibilityState){const e={eventName:u.id,eventTime:Date.now()};await t.publishEvent(e,n)}}))}}u.id="NotebookHiddenEvent";class m{listen(e,t,n){e.node.addEventListener("copy",(async()=>{var i,o;const s={id:null===(i=e.content.activeCell)||void 0===i?void 0:i.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=null===(o=document.getSelection())||void 0===o?void 0:o.toString(),c={eventName:m.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.publishEvent(c,n)}))}}m.id="ClipboardCopyEvent";class w{listen(e,t,n){e.node.addEventListener("cut",(async()=>{var i,o;const s={id:null===(i=e.content.activeCell)||void 0===i?void 0:i.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=null===(o=document.getSelection())||void 0===o?void 0:o.toString(),c={eventName:w.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.publishEvent(c,n)}))}}w.id="ClipboardCutEvent";class p{listen(e,t,n){e.node.addEventListener("paste",(async i=>{var o;const s={id:null===(o=e.content.activeCell)||void 0===o?void 0:o.model.id,index:e.content.widgets.findIndex((t=>t===e.content.activeCell))},l=(i.clipboardData||window.clipboardData).getData("text"),c={eventName:p.id,eventTime:Date.now(),eventInfo:{cells:[s],selection:l}};await t.publishEvent(c,n)}))}}p.id="ClipboardPasteEvent";class b{listen(e,t,n){e.content.activeCellChanged.connect((async(i,o)=>{if(o&&e.content.widgets){const i={id:null==o?void 0:o.model.id,index:e.content.widgets.findIndex((e=>e===o))},s={eventName:b.id,eventTime:Date.now(),eventInfo:{cells:[i]}};await t.publishEvent(s,n)}}))}}b.id="ActiveCellChangeEvent";class h{listen(e,t,n){e.context.saveState.connect((async(e,i)=>{if(i.match("completed")){const e={eventName:h.id,eventTime:Date.now()};await t.publishEvent(e,n)}}))}}h.id="NotebookSaveEvent";class E{listen(e,t,n){i.NotebookActions.executed.connect((async(e,i)=>{const o={id:i.cell.model.id,index:i.notebook.widgets.findIndex((e=>e==i.cell))},s={eventName:E.id,eventTime:Date.now(),eventInfo:{cells:[o],success:i.success,kernelError:i.success?null:i.error}};await t.publishEvent(s,n)}))}}E.id="CellExecuteEvent";class f{listen(e,t,n){var i;null===(i=e.content.model)||void 0===i||i.cells.changed.connect((async(e,i)=>{if("add"===i.type){const e={id:i.newValues[0].id,index:i.newIndex},o={eventName:f.id,eventTime:Date.now(),eventInfo:{cells:[e]}};await t.publishEvent(o,n)}}))}}f.id="CellAddEvent";class y{listen(e,t,n){var i;null===(i=e.content.model)||void 0===i||i.cells.changed.connect((async(e,i)=>{if("remove"===i.type){const e={id:i.oldValues[0].id,index:i.oldIndex},o={eventName:y.id,eventTime:Date.now(),eventInfo:{cells:[e]}};await t.publishEvent(o,n)}}))}}y.id="CellRemoveEvent";const g=[a,v,r,u,m,w,p,b,h,E,f,y],C="jupyterlab-telemetry-producer:plugin",N={id:C,autoStart:!0,requires:[o.ITelemetryRouter,i.INotebookTracker],activate:async(e,t,n)=>{const i=await c("version");console.log(`${C}: ${i}`);const o=await c("config");n.widgetAdded.connect((async(e,n)=>{await n.sessionContext.ready,await t.loadNotebookPanel(n),g.forEach((e=>{o.activeEvents.includes(e.id)&&(new e).listen(n,t,o.logNotebookContentEvents.includes(e.id))}))}))}}}}]);