import{u as be,r as V,e as Te,_ as ke,f as Ee,g as xe,a as h,j as S,R as g,h as Ce,c as ye,s as fe,S as Me,i as Q,T as M,t as Be,m as Re,k as ce,W as Ne,M as Pe,l as De,b as Le,d as Fe}from"./assets/wsPort-1ad9f18f.js";class ue{constructor(){this._stringCache=new Map}internString(e){let t=this._stringCache.get(e);return t||(this._stringCache.set(e,e),t=e),t}}class We{constructor(e,t,s,i){this._tests=new Map,this._listOnly=!1,this._clearPreviousResultsWhenTestBegins=!1,this._stringPool=new ue,this._rootSuite=new I("","root"),this._pathSeparator=e,this._reporter=t,this._reuseTestCases=s,this._reportConfig=i}dispatch(e){const{method:t,params:s}=e;if(t==="onConfigure"){this._onConfigure(s.config);return}if(t==="onProject"){this._onProject(s.project);return}if(t==="onBegin"){this._onBegin();return}if(t==="onTestBegin"){this._onTestBegin(s.testId,s.result);return}if(t==="onTestEnd"){this._onTestEnd(s.test,s.result);return}if(t==="onStepBegin"){this._onStepBegin(s.testId,s.resultId,s.step);return}if(t==="onStepEnd"){this._onStepEnd(s.testId,s.resultId,s.step);return}if(t==="onError"){this._onError(s.error);return}if(t==="onStdIO"){this._onStdIO(s.type,s.testId,s.resultId,s.data,s.isBase64);return}if(t==="onEnd")return this._onEnd(s.result);if(t==="onExit")return this._onExit()}_setClearPreviousResultsWhenTestBegins(){this._clearPreviousResultsWhenTestBegins=!0}_onConfigure(e){var t;this._rootDir=((t=this._reportConfig)==null?void 0:t.rootDir)||e.rootDir,this._listOnly=e.listOnly,this._config=this._parseConfig(e),this._reporter.onConfigure(this._config)}_onProject(e){let t=this._rootSuite.suites.find(i=>i.project().__projectId===e.id);t||(t=new I(e.name,"project"),this._rootSuite.suites.push(t),t.parent=this._rootSuite);const s=this._parseProject(e);if(t.project=()=>s,this._mergeSuitesInto(e.suites,t),this._listOnly){const i=new Set,r=a=>{a.tests.map(c=>c.testId).forEach(c=>i.add(c)),a.suites.forEach(r)};e.suites.forEach(r);const o=a=>{a.tests=a.tests.filter(c=>i.has(c.id)),a.suites.forEach(o)};o(t)}}_onBegin(){var e,t;(t=(e=this._reporter).onBegin)==null||t.call(e,this._rootSuite)}_onTestBegin(e,t){var r,o;const s=this._tests.get(e);this._clearPreviousResultsWhenTestBegins&&s._clearResults();const i=s._createTestResult(t.id);i.retry=t.retry,i.workerIndex=t.workerIndex,i.parallelIndex=t.parallelIndex,i.setStartTimeNumber(t.startTime),i.statusEx="running",(o=(r=this._reporter).onTestBegin)==null||o.call(r,s,i)}_onTestEnd(e,t){var r,o,a;const s=this._tests.get(e.testId);s.timeout=e.timeout,s.expectedStatus=e.expectedStatus,s.annotations=e.annotations;const i=s.resultsMap.get(t.id);i.duration=t.duration,i.status=t.status,i.statusEx=t.status,i.errors=t.errors,i.error=(r=i.errors)==null?void 0:r[0],i.attachments=this._parseAttachments(t.attachments),(a=(o=this._reporter).onTestEnd)==null||a.call(o,s,i),i.stepMap=new Map}_onStepBegin(e,t,s){var p,u;const i=this._tests.get(e),r=i.resultsMap.get(t),o=s.parentStepId?r.stepMap.get(s.parentStepId):void 0,a=this._absoluteLocation(s.location),c=new Ie(s,o,a);o?o.steps.push(c):r.steps.push(c),r.stepMap.set(s.id,c),(u=(p=this._reporter).onStepBegin)==null||u.call(p,i,r,c)}_onStepEnd(e,t,s){var a,c;const i=this._tests.get(e),r=i.resultsMap.get(t),o=r.stepMap.get(s.id);o.duration=s.duration,o.error=s.error,(c=(a=this._reporter).onStepEnd)==null||c.call(a,i,r,o)}_onError(e){var t,s;(s=(t=this._reporter).onError)==null||s.call(t,e)}_onStdIO(e,t,s,i,r){var p,u,v,f;const o=r?globalThis.Buffer?Buffer.from(i,"base64"):atob(i):i,a=t?this._tests.get(t):void 0,c=a&&s?a.resultsMap.get(s):void 0;e==="stdout"?(c==null||c.stdout.push(o),(u=(p=this._reporter).onStdOut)==null||u.call(p,o,a,c)):(c==null||c.stderr.push(o),(f=(v=this._reporter).onStdErr)==null||f.call(v,o,a,c))}_onEnd(e){var t,s;return(s=(t=this._reporter).onEnd)==null?void 0:s.call(t,{status:e.status,startTime:new Date(e.startTime),duration:e.duration})}_onExit(){var e,t;return this._stringPool=new ue,(t=(e=this._reporter).onExit)==null?void 0:t.call(e)}_parseConfig(e){const t={...pe,...e};return this._reportConfig&&(t.configFile=this._reportConfig.configFile,t.rootDir=this._reportConfig.rootDir,t.reportSlowTests=this._reportConfig.reportSlowTests,t.quiet=this._reportConfig.quiet),t}_parseProject(e){return{__projectId:e.id,metadata:e.metadata,name:e.name,outputDir:this._absolutePath(e.outputDir),repeatEach:e.repeatEach,retries:e.retries,testDir:this._absolutePath(e.testDir),testIgnore:J(e.testIgnore),testMatch:J(e.testMatch),timeout:e.timeout,grep:J(e.grep),grepInvert:J(e.grepInvert),dependencies:e.dependencies,teardown:e.teardown,snapshotDir:this._absolutePath(e.snapshotDir),use:{}}}_parseAttachments(e){return e.map(t=>({...t,body:t.base64&&globalThis.Buffer?Buffer.from(t.base64,"base64"):void 0}))}_mergeSuitesInto(e,t){for(const s of e){let i=t.suites.find(r=>r.title===s.title);i||(i=new I(s.title,s.type),i.parent=t,t.suites.push(i)),i.location=this._absoluteLocation(s.location),i._fileId=s.fileId,i._parallelMode=s.parallelMode,this._mergeSuitesInto(s.suites,i),this._mergeTestsInto(s.tests,i)}}_mergeTestsInto(e,t){for(const s of e){let i=this._reuseTestCases?t.tests.find(r=>r.title===s.title):void 0;i||(i=new Oe(s.testId,s.title,this._absoluteLocation(s.location)),i.parent=t,t.tests.push(i),this._tests.set(i.id,i)),this._updateTest(s,i)}}_updateTest(e,t){return t.id=e.testId,t.location=this._absoluteLocation(e.location),t.retries=e.retries,t}_absoluteLocation(e){return e&&{...e,file:this._absolutePath(e.file)}}_absolutePath(e){return e&&this._stringPool.internString(this._rootDir+this._pathSeparator+e)}}class I{constructor(e,t){this._requireFile="",this.suites=[],this.tests=[],this._parallelMode="none",this.title=e,this._type=t}allTests(){const e=[],t=s=>{for(const i of[...s.suites,...s.tests])i instanceof I?t(i):e.push(i)};return t(this),e}titlePath(){const e=this.parent?this.parent.titlePath():[];return(this.title||this._type!=="describe")&&e.push(this.title),e}project(){}}class Oe{constructor(e,t,s){this.fn=()=>{},this.results=[],this.expectedStatus="passed",this.timeout=0,this.annotations=[],this.retries=0,this.repeatEachIndex=0,this.resultsMap=new Map,this.id=e,this.title=t,this.location=s}titlePath(){const e=this.parent?this.parent.titlePath():[];return e.push(this.title),e}outcome(){var s,i;const e=[...this.results];for(;((s=e[0])==null?void 0:s.status)==="skipped"||((i=e[0])==null?void 0:i.status)==="interrupted";)e.shift();if(!e.length)return"skipped";const t=e.filter(r=>r.status!=="skipped"&&r.status!=="interrupted"&&r.status!==this.expectedStatus);return t.length?t.length===e.length?"unexpected":"flaky":"expected"}ok(){const e=this.outcome();return e==="expected"||e==="flaky"||e==="skipped"}_clearResults(){this.results=[],this.resultsMap.clear()}_createTestResult(e){const t=new je(this.results.length);return this.results.push(t),this.resultsMap.set(e,t),t}}class Ie{constructor(e,t,s){this.duration=-1,this.steps=[],this._startTime=0,this.title=e.title,this.category=e.category,this.location=s,this.parent=t,this._startTime=e.startTime}titlePath(){var t;return[...((t=this.parent)==null?void 0:t.titlePath())||[],this.title]}get startTime(){return new Date(this._startTime)}set startTime(e){this._startTime=+e}}class je{constructor(e){this.parallelIndex=-1,this.workerIndex=-1,this.duration=-1,this.stdout=[],this.stderr=[],this.attachments=[],this.status="skipped",this.steps=[],this.errors=[],this.stepMap=new Map,this.statusEx="scheduled",this._startTime=0,this.retry=e}setStartTimeNumber(e){this._startTime=e}get startTime(){return new Date(this._startTime)}set startTime(e){this._startTime=+e}}const pe={forbidOnly:!1,fullyParallel:!1,globalSetup:null,globalTeardown:null,globalTimeout:0,grep:/.*/,grepInvert:null,maxFailures:0,metadata:{},preserveOutput:"always",projects:[],reporter:[[{}.CI?"dot":"list"]],reportSlowTests:{max:5,threshold:15e3},configFile:"",rootDir:"",quiet:!1,shard:null,updateSnapshots:"missing",version:"",workers:0,webServer:null};function J(n){return n.map(e=>e.s?e.s:new RegExp(e.r.source,e.r.flags))}const Ae=({source:n})=>{const[e,t]=be(),[s,i]=V.useState(Te()),[r]=V.useState(ke(()=>import("./assets/xtermModule-443332e6.js"),["./assets/xtermModule-443332e6.js","./xtermModule.6428296b.css"],import.meta.url).then(a=>a.default)),o=V.useRef(null);return V.useEffect(()=>(Ee(i),()=>xe(i)),[]),V.useEffect(()=>{const a=n.write,c=n.clear;return(async()=>{const{Terminal:p,FitAddon:u}=await r,v=t.current;if(!v)return;const f=s==="dark-mode"?Ve:ze;if(o.current&&o.current.terminal.options.theme===f)return;o.current&&(v.textContent="");const d=new p({convertEol:!0,fontSize:13,scrollback:1e4,fontFamily:"var(--vscode-editor-font-family)",theme:f}),m=new u;d.loadAddon(m);for(const w of n.pending)d.write(w);n.write=w=>{n.pending.push(w),d.write(w)},n.clear=()=>{n.pending=[],d.clear()},d.open(v),m.fit(),o.current={terminal:d,fitAddon:m}})(),()=>{n.clear=c,n.write=a}},[r,o,t,n,s]),V.useEffect(()=>{setTimeout(()=>{o.current&&(o.current.fitAddon.fit(),n.resize(o.current.terminal.cols,o.current.terminal.rows))},250)},[e,n]),h("div",{"data-testid":"output",className:"xterm-wrapper",style:{flex:"auto"},ref:t})},ze={foreground:"#383a42",background:"#fafafa",cursor:"#383a42",black:"#000000",red:"#e45649",green:"#50a14f",yellow:"#c18401",blue:"#4078f2",magenta:"#a626a4",cyan:"#0184bc",white:"#a0a0a0",brightBlack:"#000000",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#d19a66",brightBlue:"#4078f2",brightMagenta:"#a626a4",brightCyan:"#0184bc",brightWhite:"#383a42",selectionBackground:"#d7d7d7",selectionForeground:"#383a42"},Ve={foreground:"#f8f8f2",background:"#1e1e1e",cursor:"#f8f8f0",black:"#000000",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#bd93f9",magenta:"#ff79c6",cyan:"#8be9fd",white:"#bfbfbf",brightBlack:"#4d4d4d",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#e6e6e6",selectionBackground:"#44475a",selectionForeground:"#f8f8f2"};const Ke=({title:n,children:e,setExpanded:t,expanded:s,expandOnTitleClick:i})=>S("div",{className:"expandable"+(s?" expanded":""),children:[S("div",{className:"expandable-title",onClick:()=>i&&t(!s),children:[h("div",{className:"codicon codicon-"+(s?"chevron-down":"chevron-right"),style:{cursor:"pointer",color:"var(--vscode-foreground)",marginLeft:"5px"},onClick:()=>!i&&t(!s)}),n]}),s&&h("div",{style:{marginLeft:25},children:e})]});function Ue(n){return`.playwright-artifacts-${n}`}let oe=()=>{},ge=n=>{},me={cols:80,rows:24},L=async()=>{};const j={pending:[],clear:()=>{},write:n=>j.pending.push(n),resize:(n,e)=>{me={cols:n,rows:e},H("resizeTerminal",{cols:n,rows:e})}},$e=({})=>{var ae;const[n,e]=g.useState(""),[t,s]=g.useState(!1),[i,r]=g.useState(new Map([["passed",!1],["failed",!1],["skipped",!1]])),[o,a]=g.useState(new Map),[c,p]=g.useState({config:void 0,rootSuite:void 0,loadErrors:[]}),[u,v]=g.useState(),[f,d]=g.useState({}),[m,w]=g.useState(new Set),[k,C]=g.useState(!1),[y,N]=g.useState(),[R,Y]=Ce("watch-all",!1),[ee,K]=g.useState({value:new Set}),l=g.useRef(Promise.resolve()),T=g.useRef(new Set),[_,b]=g.useState(0),[E,x]=g.useState(!1),[te,le]=g.useState(!0),we=g.useRef(null),se=g.useCallback(()=>{C(!0),K({value:new Set}),oe(pe,new I("","root"),[],void 0),_e(!0).then(async()=>{C(!1);const{hasBrowsers:B}=await L("checkBrowsers");le(B)})},[]);g.useEffect(()=>{var B;(B=we.current)==null||B.focus(),C(!0),ye({onEvent:Je,onClose:()=>x(!0)}).then(F=>{L=F,se()})},[se]),oe=g.useCallback((B,F,W,z)=>{const O=B.configFile?fe.getObject(B.configFile+":projects",void 0):void 0;for(const P of o.keys())F.suites.find(X=>X.title===P)||o.delete(P);for(const P of F.suites)o.has(P.title)||o.set(P.title,!!(O!=null&&O.includes(P.title)));!O&&o.size&&![...o.values()].includes(!0)&&o.set(o.entries().next().value[0],!0),p({config:B,rootSuite:F,loadErrors:W}),a(new Map(o)),y&&z?v({...z,total:y.testIds.size}):z||v(void 0)},[o,y]);const ie=g.useCallback((B,F)=>{B==="bounce-if-busy"&&y||(T.current=new Set([...T.current,...F]),l.current=l.current.then(async()=>{var O,P,X;const W=T.current;if(T.current=new Set,!W.size)return;{for(const D of((O=c.rootSuite)==null?void 0:O.allTests())||[])W.has(D.id)&&(D._clearResults(),D._createTestResult("pending"));p({...c})}const z="  ["+new Date().toLocaleTimeString()+"]";j.write("\x1B[2m—".repeat(Math.max(0,me.cols-z.length))+z+"\x1B[22m"),v({total:W.size,passed:0,failed:0,skipped:0}),N({testIds:W}),await L("run",{testIds:[...W],projects:[...o].filter(([D,Se])=>Se).map(([D])=>D)});for(const D of((P=c.rootSuite)==null?void 0:P.allTests())||[])((X=D.results[0])==null?void 0:X.duration)===-1&&D._clearResults();p({...c}),N(void 0)}))},[o,y,c]),A=!!y;return S("div",{className:"vbox ui-mode",children:[E&&S("div",{className:"drop-target",children:[h("div",{className:"title",children:"UI Mode disconnected"}),S("div",{children:[h("a",{href:"#",onClick:()=>window.location.reload(),children:"Reload the page"})," to reconnect"]})]}),S(Me,{sidebarSize:250,minSidebarSize:125,orientation:"horizontal",sidebarIsFirst:!0,children:[S("div",{className:"vbox",children:[S("div",{className:"vbox"+(t?"":" hidden"),children:[S(Q,{children:[h("div",{className:"section-title",style:{flex:"none"},children:"Output"}),h(M,{icon:"circle-slash",title:"Clear output",onClick:()=>j.clear()}),h("div",{className:"spacer"}),h(M,{icon:"close",title:"Close",onClick:()=>s(!1)})]}),h(Ae,{source:j})]}),h("div",{className:"vbox"+(t?" hidden":""),children:h(Xe,{item:f,rootDir:(ae=c.config)==null?void 0:ae.rootDir})})]}),S("div",{className:"vbox ui-mode-sidebar",children:[S(Q,{noShadow:!0,noMinHeight:!0,children:[h("img",{src:"playwright-logo.svg"}),h("div",{className:"section-title",children:"Playwright"}),h(M,{icon:"color-mode",title:"Toggle color mode",onClick:()=>Be()}),h(M,{icon:"refresh",title:"Reload",onClick:()=>se(),disabled:A||k}),h(M,{icon:"terminal",title:"Toggle output",toggled:t,onClick:()=>{s(!t)}}),!te&&h(M,{icon:"lightbulb-autofix",style:{color:"var(--vscode-errorForeground)"},title:"Install browsers",toggled:t,onClick:()=>{s(!0),L("installBrowsers").then(async()=>{s(!1);const{hasBrowsers:B}=await L("checkBrowsers");le(B)})}})]}),h(qe,{filterText:n,setFilterText:e,statusFilters:i,setStatusFilters:r,projectFilters:o,setProjectFilters:a,testModel:c,runTests:()=>ie("bounce-if-busy",m)}),S(Q,{noMinHeight:!0,children:[!A&&!u&&h("div",{className:"section-title",children:"Tests"}),!A&&u&&h("div",{"data-testid":"status-line",className:"status-line",children:S("div",{children:[u.passed,"/",u.total," passed (",u.passed/u.total*100|0,"%)"]})}),A&&u&&h("div",{"data-testid":"status-line",className:"status-line",children:S("div",{children:["Running ",u.passed,"/",y.testIds.size," passed (",u.passed/y.testIds.size*100|0,"%)"]})}),h(M,{icon:"play",title:"Run all",onClick:()=>ie("bounce-if-busy",m),disabled:A||k}),h(M,{icon:"debug-stop",title:"Stop",onClick:()=>H("stop"),disabled:!A||k}),h(M,{icon:"eye",title:"Watch all",toggled:R,onClick:()=>Y(!R)}),h(M,{icon:"collapse-all",title:"Collapse all",onClick:()=>{b(_+1)}})]}),h(Ye,{statusFilters:i,projectFilters:o,filterText:n,testModel:c,runningState:y,runTests:ie,onItemSelected:d,setVisibleTestIds:w,watchAll:R,watchedTreeIds:ee,setWatchedTreeIds:K,isLoading:k,requestedCollapseAllCount:_})]})]})]})},qe=({filterText:n,setFilterText:e,statusFilters:t,setStatusFilters:s,projectFilters:i,setProjectFilters:r,testModel:o,runTests:a})=>{const[c,p]=g.useState(!1),u=g.useRef(null);g.useEffect(()=>{var d;(d=u.current)==null||d.focus()},[]);const v=[...t.entries()].filter(([d,m])=>m).map(([d])=>d).join(" ")||"all",f=[...i.entries()].filter(([d,m])=>m).map(([d])=>d).join(" ")||"all";return S("div",{className:"filters",children:[h(Ke,{expanded:c,setExpanded:p,title:h("input",{ref:u,type:"search",placeholder:"Filter (e.g. text, @tag)",spellCheck:!1,value:n,onChange:d=>{e(d.target.value)},onKeyDown:d=>{d.key==="Enter"&&a()}})}),S("div",{className:"filter-summary",title:"Status: "+v+`
Projects: `+f,onClick:()=>p(!c),children:[h("span",{className:"filter-label",children:"Status:"})," ",v,h("span",{className:"filter-label",children:"Projects:"})," ",f]}),c&&S("div",{className:"hbox",style:{marginLeft:14},children:[h("div",{className:"filter-list",children:[...t.entries()].map(([d,m])=>h("div",{className:"filter-entry",children:S("label",{children:[h("input",{type:"checkbox",checked:m,onClick:()=>{const w=new Map(t);w.set(d,!w.get(d)),s(w)}}),h("div",{children:d})]})}))}),h("div",{className:"filter-list",children:[...i.entries()].map(([d,m])=>h("div",{className:"filter-entry",children:S("label",{children:[h("input",{type:"checkbox",checked:m,onClick:()=>{var C;const w=new Map(i);w.set(d,!w.get(d)),r(w);const k=(C=o==null?void 0:o.config)==null?void 0:C.configFile;k&&fe.setObject(k+":projects",[...w.entries()].filter(([y,N])=>N).map(([y])=>y))}}),h("div",{children:d})]})}))})]})]})},He=De,Ye=({statusFilters:n,projectFilters:e,filterText:t,testModel:s,runTests:i,runningState:r,watchAll:o,watchedTreeIds:a,setWatchedTreeIds:c,isLoading:p,onItemSelected:u,setVisibleTestIds:v,requestedCollapseAllCount:f})=>{const[d,m]=g.useState({expandedItems:new Map}),[w,k]=g.useState(),[C,y]=g.useState(f),{rootItem:N,treeItemMap:R,fileNames:Y}=g.useMemo(()=>{let l=Ge(s.rootSuite,s.loadErrors,e);et(l,t,n,r==null?void 0:r.testIds),ve(l),l=tt(l),st(l);const T=new Map,_=new Set,b=new Set,E=x=>{x.kind==="group"&&x.location.file&&b.add(x.location.file),x.kind==="case"&&x.tests.forEach(te=>_.add(te.id)),x.children.forEach(E),T.set(x.id,x)};return E(l),v(_),{rootItem:l,treeItemMap:T,fileNames:b}},[t,s,n,e,v,r]);g.useEffect(()=>{if(C!==f){d.expandedItems.clear();for(const _ of R.keys())d.expandedItems.set(_,!1);y(f),k(void 0),m({...d});return}if(!r||r.itemSelectedByUser)return;let l;const T=_=>{var b;_.children.forEach(T),!l&&_.status==="failed"&&(_.kind==="test"&&r.testIds.has(_.test.id)||_.kind==="case"&&r.testIds.has((b=_.tests[0])==null?void 0:b.id))&&(l=_)};T(N),l&&k(l.id)},[r,k,N,C,y,f,d,m,R]);const{selectedTreeItem:ee}=g.useMemo(()=>{const l=w?R.get(w):void 0;let T;l&&(T={file:l.location.file,line:l.location.line,source:{errors:s.loadErrors.filter(b=>{var E;return((E=b.location)==null?void 0:E.file)===l.location.file}).map(b=>({line:b.location.line,message:b.message})),content:void 0}});let _;return(l==null?void 0:l.kind)==="test"?_=l.test:(l==null?void 0:l.kind)==="case"&&l.tests.length===1&&(_=l.tests[0]),u({testCase:_,testFile:T}),{selectedTreeItem:l}},[u,w,s,R]);g.useEffect(()=>{if(!p)if(o)H("watch",{fileNames:[...Y]});else{const l=new Set;for(const T of a.value){const _=R.get(T),b=_==null?void 0:_.location.file;b&&l.add(b)}H("watch",{fileNames:[...l]})}},[p,N,Y,o,a,R]);const K=l=>{k(l.id),i("bounce-if-busy",ne(l))};return ge=l=>{const T=[],_=new Set(l);if(o){const b=E=>{const x=E.location.file;x&&_.has(x)&&T.push(...ne(E)),E.kind==="group"&&E.subKind==="folder"&&E.children.forEach(b)};b(N)}else for(const b of a.value){const E=R.get(b),x=E==null?void 0:E.location.file;x&&_.has(x)&&T.push(...ne(E))}i("queue-if-busy",new Set(T))},h(He,{treeState:d,setTreeState:m,rootItem:N,dataTestId:"test-tree",render:l=>S("div",{className:"hbox ui-mode-list-item",children:[h("div",{className:"ui-mode-list-item-title",children:l.title}),!!l.duration&&l.status!=="skipped"&&h("div",{className:"ui-mode-list-item-time",children:Re(l.duration)}),S(Q,{noMinHeight:!0,noShadow:!0,children:[h(M,{icon:"play",title:"Run",onClick:()=>K(l),disabled:!!r}),h(M,{icon:"go-to-file",title:"Open in VS Code",onClick:()=>H("open",{location:Ze(l)}),style:l.kind==="group"&&l.subKind==="folder"?{visibility:"hidden"}:{}}),!o&&h(M,{icon:"eye",title:"Watch",onClick:()=>{a.value.has(l.id)?a.value.delete(l.id):a.value.add(l.id),c({...a})},toggled:a.value.has(l.id)})]})]}),icon:l=>l.status==="scheduled"?"codicon-clock":l.status==="running"?"codicon-loading":l.status==="failed"?"codicon-error":l.status==="passed"?"codicon-check":l.status==="skipped"?"codicon-circle-slash":"codicon-circle-outline",selectedItem:ee,onAccepted:K,onSelected:l=>{r&&(r.itemSelectedByUser=!0),k(l.id)},isError:l=>l.kind==="group"?l.hasLoadErrors:!1,autoExpandDepth:t?5:1,noItemsMessage:p?"Loading…":"No tests"})},Xe=({item:n,rootDir:e})=>{const[t,s]=g.useState(),[i,r]=g.useState(0),o=g.useRef(null),{outputDir:a}=g.useMemo(()=>({outputDir:n.testCase?Qe(n.testCase):void 0}),[n]),[c,p]=g.useState(),u=g.useCallback(f=>p(ce(f)),[p]),v=c?t==null?void 0:t.model.actions.find(f=>ce(f)===c):void 0;return g.useEffect(()=>{var w,k;o.current&&clearTimeout(o.current);const f=(w=n.testCase)==null?void 0:w.results[0];if(!f){s(void 0);return}const d=f&&f.duration>=0&&f.attachments.find(C=>C.name==="trace");if(d&&d.path){he(d.path).then(C=>s({model:C,isLive:!1}));return}if(!a){s(void 0);return}const m=`${a}/${Ue(f.workerIndex)}/traces/${(k=n.testCase)==null?void 0:k.id}.json`;return o.current=setTimeout(async()=>{try{const C=await he(m);s({model:C,isLive:!0})}catch{s(void 0)}finally{r(i+1)}},500),()=>{o.current&&clearTimeout(o.current)}},[a,n,s,i,r]),h(Ne,{model:t==null?void 0:t.model,hideStackFrames:!0,showSourcesFirst:!0,rootDir:e,initialSelection:v,onSelectionChanged:u,fallbackLocation:n.testFile,isLive:t==null?void 0:t.isLive},"workbench")};let q,Z,$;const de=()=>{clearTimeout(Z),Z=void 0,oe($.config,$.rootSuite,$.loadErrors,$.progress)},U=(n,e,t,s,i=!1)=>{$={config:n,rootSuite:e,loadErrors:t,progress:s},i?de():Z||(Z=setTimeout(de,250))},_e=n=>{if(!n)return L("list",{});let e;const t=[],s={passed:0,failed:0,skipped:0};let i;return q=new We(G,{version:()=>"v2",onConfigure:r=>{i=r},onBegin:r=>{e||(e=r),s.passed=0,s.failed=0,s.skipped=0,U(i,e,t,s,!0)},onEnd:()=>{U(i,e,t,s,!0)},onTestBegin:()=>{U(i,e,t,s)},onTestEnd:r=>{r.outcome()==="skipped"?++s.skipped:r.outcome()==="unexpected"?++s.failed:++s.passed,U(i,e,t,s)},onError:r=>{j.write((r.stack||r.value||"")+`
`),t.push(r),U(i,e??new I("","root"),t,s)},printsToStdio:()=>!1,onStdOut:()=>{},onStdErr:()=>{},onExit:()=>{},onStepBegin:()=>{},onStepEnd:()=>{}},!0),q._setClearPreviousResultsWhenTestBegins(),L("list",{})},H=(n,e)=>{if(window._overrideProtocolForTest){window._overrideProtocolForTest({method:n,params:e}).catch(()=>{});return}L(n,e).catch(t=>{console.error(t)})},Je=(n,e)=>{var t;if(n==="listChanged"){_e(!1).catch(()=>{});return}if(n==="testFilesChanged"){ge(e.testFileNames);return}if(n==="stdio"){if(e.buffer){const s=atob(e.buffer);j.write(s)}else j.write(e.text);return}(t=q==null?void 0:q.dispatch({method:n,params:e}))==null||t.catch(()=>{})},Qe=n=>{var e;for(let t=n.parent;t;t=t.parent)if(t.project())return(e=t.project())==null?void 0:e.outputDir},Ze=n=>{if(n)return n.location.file+":"+n.location.line},ne=n=>{const e=new Set;if(!n)return e;const t=s=>{var i;s.kind==="case"?s.tests.map(r=>r.id).forEach(r=>e.add(r)):s.kind==="test"?e.add(s.id):(i=s.children)==null||i.forEach(t)};return t(n),e};function re(n,e,t,s){if(e.length===0)return n;const i=e.join(G),r=s.get(i);if(r)return r;const o=re(n,e.slice(0,e.length-1),!1,s),a={kind:"group",subKind:t?"file":"folder",id:i,title:e[e.length-1],location:{file:i,line:0,column:0},duration:0,parent:o,children:[],status:"none",hasLoadErrors:!1};return o.children.push(a),s.set(i,a),a}function Ge(n,e,t){const s=[...t.values()].some(Boolean),i={kind:"group",subKind:"folder",id:"root",title:"",location:{file:"",line:0,column:0},duration:0,parent:void 0,children:[],status:"none",hasLoadErrors:!1},r=(a,c,p)=>{for(const u of c.suites){const v=u.title||"<anonymous>";let f=p.children.find(d=>d.title===v);f||(f={kind:"group",subKind:"describe",id:p.id+""+v,title:v,location:u.location,duration:0,parent:p,children:[],status:"none",hasLoadErrors:!1},p.children.push(f)),r(a,u,f)}for(const u of c.tests){const v=u.title;let f=p.children.find(w=>w.title===v);f||(f={kind:"case",id:p.id+""+v,title:v,parent:p,children:[],tests:[],location:u.location,duration:0,status:"none"},p.children.push(f));const d=u.results[0];let m="none";(d==null?void 0:d.statusEx)==="scheduled"?m="scheduled":(d==null?void 0:d.statusEx)==="running"?m="running":(d==null?void 0:d.status)==="skipped"?m="skipped":(d==null?void 0:d.status)==="interrupted"?m="none":d&&u.outcome()!=="expected"?m="failed":d&&u.outcome()==="expected"&&(m="passed"),f.tests.push(u),f.children.push({kind:"test",id:u.id,title:a,location:u.location,test:u,parent:f,children:[],status:m,duration:u.results.length?Math.max(0,u.results[0].duration):0,project:a}),f.duration=f.children.reduce((w,k)=>w+k.duration,0)}},o=new Map;for(const a of(n==null?void 0:n.suites)||[])if(!(s&&!t.get(a.title)))for(const c of a.suites){const p=re(i,c.location.file.split(G),!0,o);r(a.title,c,p)}for(const a of e){if(!a.location)continue;const c=re(i,a.location.file.split(G),!0,o);c.hasLoadErrors=!0}return i}function et(n,e,t,s){const i=e.trim().toLowerCase().split(" "),r=[...t.values()].some(Boolean),o=c=>{const p=c.tests[0].titlePath().join(" ").toLowerCase();return!i.every(u=>p.includes(u))&&!c.tests.some(u=>s==null?void 0:s.has(u.id))?!1:(c.children=c.children.filter(u=>!r||(s==null?void 0:s.has(u.id))||t.get(u.status)),c.tests=c.children.map(u=>u.test),!!c.children.length)},a=c=>{const p=[];for(const u of c.children)u.kind==="case"?o(u)&&p.push(u):(a(u),(u.children.length||u.hasLoadErrors)&&p.push(u));c.children=p};a(n)}function ve(n){for(const o of n.children)ve(o);n.kind==="group"&&n.children.sort((o,a)=>o.location.file.localeCompare(a.location.file)||o.location.line-a.location.line);let e=n.children.length>0,t=n.children.length>0,s=!1,i=!1,r=!1;for(const o of n.children)t=t&&o.status==="skipped",e=e&&(o.status==="passed"||o.status==="skipped"),s=s||o.status==="failed",i=i||o.status==="running",r=r||o.status==="scheduled";i?n.status="running":r?n.status="scheduled":s?n.status="failed":t?n.status="skipped":e&&(n.status="passed")}function tt(n){let e=n;for(;e.children.length===1&&e.children[0].kind==="group"&&e.children[0].subKind==="folder";)e=e.children[0];return e.location=n.location,e}function st(n){const e=t=>{t.kind==="case"&&t.children.length===1?t.children=[]:t.children.forEach(e)};e(n)}async function he(n){const e=new URLSearchParams;e.set("trace",n);const s=await(await fetch(`contexts?${e.toString()}`)).json();return new Pe(s)}const G=navigator.userAgent.toLowerCase().includes("windows")?"\\":"/";(async()=>(Le(),window.location.protocol!=="file:"&&(window.location.href.includes("isUnderTest=true")&&await new Promise(n=>setTimeout(n,1e3)),navigator.serviceWorker.register("sw.bundle.js"),navigator.serviceWorker.controller||await new Promise(n=>{navigator.serviceWorker.oncontrollerchange=()=>n()}),setInterval(function(){fetch("ping")},1e4)),Fe.render(h($e,{}),document.querySelector("#root"))))();
