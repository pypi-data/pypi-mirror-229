(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(93442)}])},93442:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSG:function(){return eN},default:function(){return eC}});var a,l,s=r(85893),n=r(63072),o=r(37096),i=r(67294);let d=e=>{let{size:t="1em",className:r=""}=e;return(0,s.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(r),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,s.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,s.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,s.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,s.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,s.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,s.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,s.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var c=r(21223),x=r(23461);let u=e=>{let{prompts:t,activePromptIndex:r,onSelect:a,onMouseOver:l,promptListRef:n}=e;return(0,s.jsx)("ul",{ref:n,className:"z-10 w-full rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] max-h-52 overflow-scroll",children:t.map((e,t)=>(0,s.jsx)("li",{className:"".concat(t===r?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),a()},onMouseEnter:()=>l(t),children:e.name},e.id))})},m=e=>{let{prompt:t,variables:r,onSubmit:a,onClose:l}=e,[n,o]=(0,i.useState)(r.map(e=>({key:e,value:""})).filter((e,t,r)=>r.findIndex(t=>t.key===e.key)===t)),d=(0,i.useRef)(null),c=(0,i.useRef)(null),x=(e,t)=>{o(r=>{let a=[...r];return a[e].value=t,a})},u=()=>{if(n.some(e=>""===e.value)){alert("Please fill out all variables");return}a(n.map(e=>e.value)),l()},m=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&l():(e.preventDefault(),u())};return(0,i.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&l()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[l]),(0,i.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:m,children:(0,s.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-hidden overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,s.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),n.map((e,t)=>(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,s.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>x(t,e.target.value),rows:3})]},t)),(0,s.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:u,children:"Submit"})]})})},h=e=>{var t;let{messageIsStreaming:r,model:a,conversationIsEmpty:l,messages:n,prompts:d,onSend:h,onRegenerate:p,stopConversationRef:g,textareaRef:f}=e,{t:v}=(0,o.$G)("chat"),[b,w]=(0,i.useState)(),[j,y]=(0,i.useState)(!1),[k,N]=(0,i.useState)(!1),[C,S]=(0,i.useState)(0),[I,E]=(0,i.useState)(""),[z,D]=(0,i.useState)([]),[T,_]=(0,i.useState)(!1),L=(0,i.useRef)(null),Z=d.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())),O=e=>{let t=e.target.value,r=a.maxLength;if(t.length>r){alert(v("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}w(t),U(t)},P=()=>{if(!r){if(!b){alert(v("Please enter a message"));return}h({role:"user",content:b}),w(""),window.innerWidth<640&&f&&f.current&&f.current.blur()}},G=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},R=()=>{let e=Z[C];e&&(w(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),F(e)),N(!1)},A=e=>{k?"ArrowDown"===e.key?(e.preventDefault(),S(e=>e<d.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),S(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),S(e=>e<d.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),R()):"Escape"===e.key?(e.preventDefault(),N(!1)):S(0):"Enter"!==e.key||j||G()||e.shiftKey||(e.preventDefault(),P())},M=e=>{let t;let r=/{{(.*?)}}/g,a=[];for(;null!==(t=r.exec(e));)a.push(t[1]);return a},U=(0,i.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(N(!0),E(t[0].slice(1))):(N(!1),E(""))},[]),F=e=>{let t=M(e.content);D(t),t.length>0?_(!0):(w(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),U(e.content))},J=e=>{let t=null==b?void 0:b.replace(/{{(.*?)}}/g,(t,r)=>{let a=z.indexOf(r);return e[a]});w(t),f&&f.current&&f.current.focus()};return(0,i.useEffect)(()=>{L.current&&(L.current.scrollTop=30*C)},[C]),(0,i.useEffect)(()=>{if(f&&f.current){var e,t;f.current.style.height="inherit",f.current.style.height="".concat(null===(e=f.current)||void 0===e?void 0:e.scrollHeight,"px"),f.current.style.overflow="".concat((null==f?void 0:null===(t=f.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[b]),(0,i.useEffect)(()=>{let e=e=>{L.current&&!L.current.contains(e.target)&&N(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:(0,s.jsxs)("div",{className:"stretch mx-2 mt-4 flex flex-row gap-3 last:mb-2 md:mx-4 md:mt-[52px] md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:[!r&&!l&&(0,s.jsxs)("button",{className:"absolute left-0 right-0 mx-auto mt-2 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:top-0",onClick:p,children:[(0,s.jsx)(c.Z,{size:16})," ",v("Regenerate response")]}),(0,s.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[(0,s.jsx)("textarea",{ref:f,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-2 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-4",style:{resize:"none",bottom:"".concat(null==f?void 0:null===(t=f.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(f.current&&f.current.scrollHeight>400?"auto":"hidden"),outline:"none"},placeholder:v("Type a message ...")||"",value:b,rows:1,onCompositionStart:()=>y(!0),onCompositionEnd:()=>y(!1),onChange:O,onKeyDown:A}),(0,s.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:P,children:(0,s.jsx)(x.Z,{size:18})}),k&&Z.length>0&&(0,s.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,s.jsx)(u,{activePromptIndex:C,prompts:Z,onSelect:R,onMouseOver:S,promptListRef:L})}),T&&(0,s.jsx)(m,{prompt:d[C],variables:z,onSubmit:J,onClose:()=>_(!1)})]})]})})},p=()=>(0,s.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"flex gap-4 p-4 m-auto text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("img",{src:"/static/bot-avatar.png",style:{width:"32px",borderRadius:"4px"}}),(0,s.jsxs)("div",{className:"typing_indicator",children:[(0,s.jsx)("span",{style:{animation:"1s blink infinite 0.3333s"}}),(0,s.jsx)("span",{style:{animation:"1s blink infinite 0.6666s"}}),(0,s.jsx)("span",{style:{animation:"1s blink infinite 0.9999s"}})]})]})});var g=r(21942),f=r(88198),v=r(93625),b=r(45884),w=r(29758),j=r(30399);let y={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="ABCDEFGHJKLMNPQRSTUVWXY3456789",a="";for(let t=0;t<e;t++)a+=r.charAt(Math.floor(Math.random()*r.length));return t?a.toLowerCase():a};var N=r(67828),C=r(80335),S=r(93179),I=r(84283);let E=(0,i.memo)(e=>{let{language:t,value:r}=e,{t:a}=(0,o.$G)("markdown"),[l,n]=(0,i.useState)(!1),d=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(r).then(()=>{n(!0),setTimeout(()=>{n(!1)},2e3)})},c=()=>{let e=y[t]||".file",l="file-".concat(k(3,!0)).concat(e),s=window.prompt(a("Enter file name")||"",l);if(!s)return;let n=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.download=s,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,s.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,s.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:d,children:[l?(0,s.jsx)(f.Z,{size:18}):(0,s.jsx)(N.Z,{size:18}),l?a("Copied!"):a("Copy code")]}),(0,s.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:c,children:(0,s.jsx)(C.Z,{size:18})})]})]}),(0,s.jsx)(S.Z,{language:t,style:I.vk,customStyle:{margin:0},children:r})]})});E.displayName="CodeBlock";var z=r(16202);let D=(0,i.memo)(z.D),T=(0,i.memo)(e=>{let{message:t,messageIndex:r,onEditMessage:a}=e,{t:l}=(0,o.$G)("chat"),[n,d]=(0,i.useState)(!1),[c,x]=(0,i.useState)(!1),[u,m]=(0,i.useState)(t.content),[h,p]=(0,i.useState)(!1),y=(0,i.useRef)(null),k=()=>{d(!n)},N=e=>{m(e.target.value),y.current&&(y.current.style.height="inherit",y.current.style.height="".concat(y.current.scrollHeight,"px"))},C=()=>{t.content!=u&&a({...t,content:u},r),d(!1)},S=e=>{"Enter"!==e.key||c||e.shiftKey||(e.preventDefault(),C())},I=()=>{navigator.clipboard&&navigator.clipboard.writeText(t.content).then(()=>{p(!0),setTimeout(()=>{p(!1)},2e3)})};return(0,i.useEffect)(()=>{y.current&&(y.current.style.height="inherit",y.current.style.height="".concat(y.current.scrollHeight,"px"))},[n]),(0,s.jsx)("div",{className:"group px-4 ".concat("assistant"===t.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"relative m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===t.role?(0,s.jsx)("img",{src:"/static/bot-avatar.png",style:{width:"32px",borderRadius:"4px"}}):(0,s.jsx)("img",{src:"/static/user-avatar.png",style:{width:"32px",borderRadius:"4px"}})}),(0,s.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:"user"===t.role?(0,s.jsxs)("div",{className:"flex w-full",children:[n?(0,s.jsxs)("div",{className:"flex w-full flex-col",children:[(0,s.jsx)("textarea",{ref:y,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:u,onChange:N,onKeyDown:S,onCompositionStart:()=>x(!0),onCompositionEnd:()=>x(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,s.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,s.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:C,disabled:u.trim().length<=0,children:l("Save & Submit")}),(0,s.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{m(t.content),d(!1)},children:l("Cancel")})]})]}):(0,s.jsx)("div",{className:"prose whitespace-pre-wrap dark:prose-invert",children:t.content}),(window.innerWidth<640||!n)&&(0,s.jsx)("button",{className:"absolute translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300 ".concat(window.innerWidth<640?"right-3 bottom-1":"right-0 top-[26px]","\n                    "),onClick:k,children:(0,s.jsx)(g.Z,{size:20})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute ".concat(window.innerWidth<640?"right-3 bottom-1":"right-0 top-[26px] m-0"),children:h?(0,s.jsx)(f.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,s.jsx)("button",{className:"translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300",onClick:I,children:(0,s.jsx)(v.Z,{size:20})})}),(0,s.jsx)(D,{className:"prose dark:prose-invert",remarkPlugins:[w.Z,j.Z],rehypePlugins:[b.Z],components:{code(e){let{node:t,inline:r,className:a,children:l,...n}=e,o=/language-(\w+)/.exec(a||"");return!r&&o?(0,s.jsx)(E,{language:o[1],value:String(l).replace(/\n$/,""),...n},Math.random()):(0,s.jsx)("code",{className:a,...n,children:l})},table(e){let{children:t}=e;return(0,s.jsx)("table",{className:"border-collapse border border-black py-1 px-3 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,s.jsx)("th",{className:"break-words border border-black bg-gray-500 py-1 px-3 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,s.jsx)("td",{className:"break-words border border-black py-1 px-3 dark:border-white",children:t})}},children:t.content})]})})]})})});T.displayName="ChatMessage";var _=r(58403);let L=e=>{let{error:t}=e;return(0,s.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,s.jsx)("div",{className:"mb-5",children:(0,s.jsx)(_.Z,{size:36})}),(0,s.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,s.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,s.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,s.jsxs)("i",{children:["Code: ",t.code]}):""})]})},Z=e=>{let{model:t,models:r,defaultModelId:a,onModelChange:l}=e,{t:n}=(0,o.$G)("chat");return r.length,a=r.length>0?r[0].id:a,(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"mb-8 text-neutral-700 dark:text-neutral-400",children:"Choose a rails configuration and start chatting using the input box at the bottom."}),(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:n("Guardrails Configuration")}),(0,s.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,s.jsx)("select",{className:"w-full bg-transparent p-2",placeholder:n("Select a model")||"",value:(null==t?void 0:t.id)||a,onChange:e=>{l(r.find(t=>t.id===e.target.value))},children:r.map(e=>(0,s.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.id===a?"Default (".concat(e.name,")"):e.name},e.id))})})]})},O=(0,i.memo)(e=>{let t,r,{conversations:a,conversation:l,models:c,apiKey:x,serverSideApiKeyIsSet:u,defaultModelId:m,messageIsStreaming:g,modelError:f,loading:v,prompts:b,onSend:w,onUpdateConversation:j,onEditMessage:y,stopConversationRef:k}=e,{t:N}=(0,o.$G)("chat"),[C,S]=(0,i.useState)(),[I,E]=(0,i.useState)(!0),[z,D]=(0,i.useState)(!1),[_,O]=(0,i.useState)(!1),P=(0,i.useRef)(null),G=(0,i.useRef)(null),R=(0,i.useRef)(null);(0,i.useCallback)(()=>{if(I){var e,t;null===(e=P.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=R.current)||void 0===t||t.focus()}},[I]);let A=()=>{if(G.current){let{scrollTop:e,scrollHeight:t,clientHeight:r}=G.current;e+r<t-30?(E(!1),O(!0)):(E(!0),O(!1))}},M=()=>{var e;null===(e=G.current)||void 0===e||e.scrollTo({top:G.current.scrollHeight,behavior:"smooth"})},U=()=>{if(I){var e;null===(e=P.current)||void 0===e||e.scrollIntoView(!0)}},F=function(){for(var e=arguments.length,a=Array(e),l=0;l<e;l++)a[l]=arguments[l];r?(clearTimeout(t),t=setTimeout(()=>{Date.now()-r>=250&&(U(...a),r=Date.now())},250-(Date.now()-r))):(U(...a),r=Date.now())};return(0,i.useEffect)(()=>{F(),S(l.messages[l.messages.length-2])},[l.messages,F]),(0,i.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(E(t.isIntersecting),t.isIntersecting){var r;null===(r=R.current)||void 0===r||r.focus()}},{root:null,threshold:.5}),t=P.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[P]),(0,s.jsxs)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:[0==a.length?(0,s.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"Welcome to Guardrails Chat"}),(0,s.jsxs)("div",{className:"text-center text-lg text-black dark:text-white",children:[(0,s.jsx)("div",{className:"mb-8",children:'To get started, click the "New chat" button on the top left. '}),(0,s.jsx)("div",{className:"mb-2 font-bold",children:"Important: This UI is meant for testing purposes, not for production."})]}),(0,s.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[(0,s.jsx)("div",{className:"mb-2",children:"If you run the server in production, make sure you disable this UI using the --disable-ui flag."}),(0,s.jsxs)("div",{children:["This chat interface was forked from\xa0",(0,s.jsx)("a",{href:"https://github.com/mckaywrigley/chatbot-ui",target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:underline",children:"Chatbot UI"}),"."]})]})]}):f?(0,s.jsx)(L,{error:f}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:G,onScroll:A,children:0===l.messages.length?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"mx-auto flex w-[350px] flex-col space-y-10 pt-12 sm:w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:0===c.length?(0,s.jsx)("div",{children:(0,s.jsx)(d,{size:"16px",className:"mx-auto"})}):"Guardrails Chat"}),c.length>0&&(0,s.jsx)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:(0,s.jsx)(Z,{model:l.model,models:c,defaultModelId:m,onModelChange:e=>j(l,{key:"model",value:e})})})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[N("Guardrails"),": ",l.model.name]}),z&&(0,s.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,s.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,s.jsx)(Z,{model:l.model,models:c,defaultModelId:m,onModelChange:e=>j(l,{key:"model",value:e})})})}),l.messages.map((e,t)=>(0,s.jsx)(T,{message:e,messageIndex:t,onEditMessage:y},t)),v&&(0,s.jsx)(p,{}),(0,s.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:P})]})}),(0,s.jsx)(h,{stopConversationRef:k,textareaRef:R,messageIsStreaming:g,conversationIsEmpty:0===l.messages.length,messages:l.messages,model:l.model,prompts:b,onSend:e=>{S(e),w(e)},onRegenerate:()=>{C&&w(C,2)}})]}),_&&(0,s.jsx)("div",{className:"absolute bottom-0 right-0 mb-4 mr-4 pb-20",children:(0,s.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-200 text-gray-700 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700",onClick:M,children:(0,s.jsx)(n.Z,{size:18})})})]})});O.displayName="Chat";var P=r(1177),G=r(16745),R=r(89014),A=r(55814),M=r(87664),U=r(62577),F=r(97283),J=r(30471),K=r(74075),H=r(47447);let $=e=>{let{selectedConversation:t,conversation:r,loading:a,onSelectConversation:l,onDeleteConversation:n,onUpdateConversation:o}=e,[d,c]=(0,i.useState)(!1),[x,u]=(0,i.useState)(!1),[m,h]=(0,i.useState)(""),p=e=>{"Enter"===e.key&&(e.preventDefault(),v(t))},g=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},v=e=>{m.trim().length>0&&(o(e,{key:"name",value:m}),h(""),u(!1))};return(0,i.useEffect)(()=>{x?c(!1):d&&u(!1)},[x,d]),(0,s.jsxs)("div",{className:"relative flex items-center",children:[x&&t.id===r.id?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3 rounded-lg",children:[(0,s.jsx)(H.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:m,onChange:e=>h(e.target.value),onKeyDown:p,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(a?"disabled:cursor-not-allowed":""," ").concat(t.id===r.id?"bg-[#343541]/90":""," ").concat(t.id===r.id?"text-[#76b900]/100":""),onClick:()=>l(r),disabled:a,draggable:"true",onDragStart:e=>g(e,r),children:[(0,s.jsx)(H.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat(t.id===r.id?"pr-12":"pr-1"),children:r.name})]}),(d||x)&&t.id===r.id&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),d?n(r):x&&v(r),c(!1),u(!1)},children:(0,s.jsx)(f.Z,{size:18})}),(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),c(!1),u(!1)},children:(0,s.jsx)(F.Z,{size:18})})]}),t.id===r.id&&!d&&!x&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),u(!0),h(t.name)},children:(0,s.jsx)(J.Z,{size:18})}),(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),c(!0)},children:(0,s.jsx)(K.Z,{size:18})})]})]})},W=e=>{let{searchTerm:t,conversations:r,currentFolder:a,onDeleteFolder:l,onUpdateFolder:n,selectedConversation:o,loading:d,onSelectConversation:c,onDeleteConversation:x,onUpdateConversation:u}=e,[m,h]=(0,i.useState)(!1),[p,g]=(0,i.useState)(!1),[v,b]=(0,i.useState)(""),[w,j]=(0,i.useState)(!1),y=e=>{"Enter"===e.key&&(e.preventDefault(),k())},k=()=>{n(a.id,v),b(""),g(!1)},N=(e,t)=>{if(e.dataTransfer){j(!0);let r=JSON.parse(e.dataTransfer.getData("conversation"));u(r,{key:"folderId",value:t.id}),e.target.style.background="none"}},C=e=>{e.preventDefault()},S=e=>{e.target.style.background="#343541"},I=e=>{e.target.style.background="none"};return(0,i.useEffect)(()=>{p?h(!1):m&&g(!1)},[p,m]),(0,i.useEffect)(()=>{t?j(!0):j(!1)},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative flex items-center",children:[p?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3 rounded-lg",children:[w?(0,s.jsx)(M.Z,{size:18}):(0,s.jsx)(U.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:v,onChange:e=>b(e.target.value),onKeyDown:y,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>j(!w),onDrop:e=>N(e,a),onDragOver:C,onDragEnter:S,onDragLeave:I,children:[w?(0,s.jsx)(M.Z,{size:18}):(0,s.jsx)(U.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:a.name})]}),(m||p)&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),m?l(a.id):p&&k(),h(!1),g(!1)},children:(0,s.jsx)(f.Z,{size:18})}),(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),h(!1),g(!1)},children:(0,s.jsx)(F.Z,{size:18})})]}),!m&&!p&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),g(!0),b(a.name)},children:(0,s.jsx)(J.Z,{size:18})}),(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:e=>{e.stopPropagation(),h(!0)},children:(0,s.jsx)(K.Z,{size:18})})]})]}),w?r.map((e,t)=>{if(e.folderId===a.id)return(0,s.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,s.jsx)($,{selectedConversation:o,conversation:e,loading:d,onSelectConversation:c,onDeleteConversation:x,onUpdateConversation:u})},t)}):null]})},B=e=>{let{searchTerm:t,conversations:r,folders:a,onDeleteFolder:l,onUpdateFolder:n,selectedConversation:o,loading:i,onSelectConversation:d,onDeleteConversation:c,onUpdateConversation:x}=e;return(0,s.jsx)("div",{className:"flex w-full flex-col pt-2",children:a.map((e,a)=>(0,s.jsx)(W,{searchTerm:t,conversations:r.filter(e=>e.folderId),currentFolder:e,onDeleteFolder:l,onUpdateFolder:n,selectedConversation:o,loading:i,onSelectConversation:d,onDeleteConversation:c,onUpdateConversation:x},a))})},Y=e=>{let{placeholder:t,searchTerm:r,onSearch:a}=e,{t:l}=(0,o.$G)("sidebar"),n=e=>{a(e.target.value)},i=()=>{a("")};return(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:l(t)||"",value:r,onChange:n}),r&&(0,s.jsx)(F.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:i})]})};var q=r(75846),V=r(51047),X=r(64738),Q=r(52216);let ee=e=>{let{text:t,icon:r,onClick:a}=e;return(0,s.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:a,children:[(0,s.jsx)("div",{children:r}),(0,s.jsx)("span",{children:t})]})},et=e=>{let{onImport:t}=e,{t:r}=(0,o.$G)("sidebar");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{id:"import-file",className:"sr-only",tabIndex:-1,type:"file",accept:".json",onChange:e=>{var r;if(!(null===(r=e.target.files)||void 0===r?void 0:r.length))return;let a=e.target.files[0],l=new FileReader;l.onload=e=>{var r;t(JSON.parse(null===(r=e.target)||void 0===r?void 0:r.result))},l.readAsText(a)}}),(0,s.jsx)(ee,{text:r("Import conversations"),icon:(0,s.jsx)(Q.Z,{size:18}),onClick:()=>{let e=document.querySelector("#import-file");e&&e.click()}})]})},er=e=>{let{onClearConversations:t}=e,[r,a]=(0,i.useState)(!1),{t:l}=(0,o.$G)("sidebar"),n=()=>{t(),a(!1)};return r?(0,s.jsxs)("div",{className:"flex w-full cursor-pointer items-center rounded-lg py-3 px-3 hover:bg-gray-500/10",children:[(0,s.jsx)(K.Z,{size:18}),(0,s.jsx)("div",{className:"ml-3 flex-1 text-left text-[12.5px] leading-3 text-white",children:l("Are you sure?")}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(f.Z,{className:"ml-auto min-w-[20px] mr-1 text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),n()}}),(0,s.jsx)(F.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),a(!1)}})]})]}):(0,s.jsx)(ee,{text:l("Clear conversations"),icon:(0,s.jsx)(K.Z,{size:18}),onClick:()=>a(!0)})},ea=e=>{let{lightMode:t,apiKey:r,conversationsCount:a,onToggleLightMode:l,onApiKeyChange:n,onClearConversations:i,onExportConversations:d,onImportConversations:c}=e,{t:x}=(0,o.$G)("sidebar");return(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[a>0?(0,s.jsx)(er,{onClearConversations:i}):null,(0,s.jsx)(et,{onImport:c}),(0,s.jsx)(ee,{text:x("Export conversations"),icon:(0,s.jsx)(q.Z,{size:18}),onClick:()=>d()}),(0,s.jsx)(ee,{text:x("light"===t?"Dark mode":"Light mode"),icon:"light"===t?(0,s.jsx)(V.Z,{size:18}):(0,s.jsx)(X.Z,{size:18}),onClick:()=>l("light"===t?"dark":"light")})]})},el=e=>{let{loading:t,conversations:r,selectedConversation:a,onSelectConversation:l,onDeleteConversation:n,onUpdateConversation:o}=e;return(0,s.jsx)("div",{className:"flex w-full flex-col gap-1",children:r.slice().reverse().map((e,r)=>(0,s.jsx)($,{selectedConversation:a,conversation:e,loading:t,onSelectConversation:l,onDeleteConversation:n,onUpdateConversation:o},r))})},es=e=>{let{loading:t,conversations:r,lightMode:a,selectedConversation:l,apiKey:n,folders:d,onCreateFolder:c,onDeleteFolder:x,onUpdateFolder:u,onNewConversation:m,onToggleLightMode:h,onSelectConversation:p,onDeleteConversation:g,onToggleSidebar:f,onUpdateConversation:v,onApiKeyChange:b,onClearConversations:w,onExportConversations:j,onImportConversations:y}=e,{t:k}=(0,o.$G)("sidebar"),[N,C]=(0,i.useState)(""),[S,I]=(0,i.useState)(r),E=(e,t)=>{v(e,t),C("")},z=e=>{g(e),C("")},D=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));v(t,{key:"folderId",value:0}),e.target.style.background="none"}},T=e=>{e.preventDefault()},_=e=>{e.target.style.background="#343541"},L=e=>{e.target.style.background="none"};return(0,i.useEffect)(()=>{N?I(r.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(N.toLowerCase())})):I(r)},[N,r]),(0,s.jsxs)("div",{className:"fixed top-0 bottom-0 z-50 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 transition-all sm:relative sm:top-0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{className:"flex w-[190px] flex-shrink-0 cursor-pointer select-none items-center gap-3 rounded-md border border-white/20 p-3 text-[14px] leading-normal text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>{m(),C("")},children:[(0,s.jsx)(P.Z,{size:18}),k("New chat")]}),(0,s.jsx)("button",{className:"ml-2 flex flex-shrink-0 cursor-pointer items-center gap-3 rounded-md border border-white/20 p-3 text-[14px] leading-normal text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>c(k("New folder")),children:(0,s.jsx)(G.Z,{size:18})}),(0,s.jsx)(R.Z,{className:"ml-1 hidden cursor-pointer p-1 text-neutral-300 hover:text-neutral-400 sm:flex",size:32,onClick:f})]}),r.length>1&&(0,s.jsx)(Y,{placeholder:"Search conversations...",searchTerm:N,onSearch:C}),(0,s.jsxs)("div",{className:"flex-grow overflow-auto",children:[d.length>0&&(0,s.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:(0,s.jsx)(B,{searchTerm:N,conversations:S.filter(e=>e.folderId),folders:d,onDeleteFolder:x,onUpdateFolder:u,selectedConversation:l,loading:t,onSelectConversation:p,onDeleteConversation:z,onUpdateConversation:E})}),r.length>0?(0,s.jsx)("div",{className:"h-full pt-2",onDrop:e=>D(e),onDragOver:T,onDragEnter:_,onDragLeave:L,children:(0,s.jsx)(el,{loading:t,conversations:S.filter(e=>!e.folderId),selectedConversation:l,onSelectConversation:p,onDeleteConversation:z,onUpdateConversation:E})}):(0,s.jsxs)("div",{className:"flex flex-col gap-3 items-center text-sm leading-normal mt-8 text-white opacity-50",children:[(0,s.jsx)(A.Z,{}),k("No conversations.")]})]}),(0,s.jsx)(ea,{lightMode:a,apiKey:n,conversationsCount:r.length,onToggleLightMode:h,onApiKeyChange:b,onClearConversations:w,onExportConversations:j,onImportConversations:y})]})},en=e=>{let{selectedConversation:t,onNewConversation:r}=e;return(0,s.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,s.jsx)("div",{className:"mr-4"}),(0,s.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,s.jsx)(P.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:r})]})};r(67421),(a=l||(l={})).GPT_3_5="gpt-3.5-turbo",a.GPT_4="gpt-4",a.GENERAL="general",l.GENERAL;let eo={[l.GPT_3_5]:{id:l.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:3e3},[l.GPT_4]:{id:l.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:6e3},[l.GENERAL]:{id:l.GENERAL,name:"general",maxLength:24e3,tokenLimit:6e3}};var ei=r(83454);let ed=ei.env.DEFAULT_SYSTEM_PROMPT||"You are ChatGPT, a large language model trained by OpenAI. Follow the user's instructions carefully. Respond using markdown.";ei.env.OPENAI_API_HOST;let ec=e=>{let t=e;return t.model||(t={...t,model:t.model||eo[l.GPT_3_5]}),t.prompt||(t={...t,prompt:t.prompt||ed}),t.folderId||(t={...t,folderId:t.folderId||null}),t},ex=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=eo[l.GPT_3_5]),t.prompt||(t.prompt=ed),t.folderId||(t.folderId=null),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),eu=(e,t)=>{let r=t.map(t=>t.id===e.id?e:t);return em(e),eh(r),{single:e,all:r}},em=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},eh=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},ep=e=>{localStorage.setItem("folders",JSON.stringify(e))},eg=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t));let r={version:3,history:e||[],folders:t||[]},a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),s=document.createElement("a");s.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,r=e.getDate();return"".concat(t,"-").concat(r)}(),".json"),s.href=l,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)},ef=e=>{let t=function(e){if(Array.isArray(e))return{version:3,history:ex(e),folders:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:3,history:ex(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"}))};if(3===e.version)return e;throw Error("Unsupported data format")}(e),r=t.history;return localStorage.setItem("conversationHistory",JSON.stringify(r)),localStorage.setItem("selectedConversation",JSON.stringify(r[r.length-1])),localStorage.setItem("folders",JSON.stringify(t.folders)),t},ev=e=>{localStorage.setItem("prompts",JSON.stringify(e))};var eb=r(98963),ew=r(9008),ej=r.n(ew),ey=r(57632);let ek=e=>{let{serverSideApiKeyIsSet:t,defaultModelId:r}=e,{t:a}=(0,o.$G)("chat"),[l,n]=(0,i.useState)(""),[d,c]=(0,i.useState)(!1),[x,u]=(0,i.useState)("light"),[m,h]=(0,i.useState)(!1),[p,g]=(0,i.useState)(null),[f,v]=(0,i.useState)([]),[b,w]=(0,i.useState)([]),[j,y]=(0,i.useState)([]),[k,N]=(0,i.useState)(),[C,S]=(0,i.useState)(),[I,E]=(0,i.useState)(!0),[z,D]=(0,i.useState)([]),[T,_]=(0,i.useState)(!0),L=(0,i.useRef)(!1),Z=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(k){let r;if(t){let a=[...k.messages];for(let e=0;e<t;e++)a.pop();r={...k,messages:[...a,e]}}else r={...k,messages:[...k.messages,e]};N(r),c(!0),h(!0);let a={model:r.model,messages:r.messages,key:l,prompt:r.prompt,config_id:r.model.id},s=new AbortController,n=await fetch("/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},signal:s.signal,body:JSON.stringify(a)});if(!n.ok){c(!1),h(!1);return}let o=await n.json();if(!o){c(!1),h(!1);return}if(1===r.messages.length){let{content:t}=e,a=t.length>30?t.substring(0,30)+"...":t;r={...r,name:a}}c(!1);let i=[...r.messages,{role:"assistant",content:o.messages[0].content}];N(r={...r,messages:i}),em(r);let d=j.map(e=>e.id===k.id?r:e);0===d.length&&d.push(r),y(d),eh(d),h(!1)}},P=async e=>{let t={title:a("Error fetching models."),code:null,messageLines:[a("Make sure your OpenAI API key is set in the bottom left of the sidebar."),a("If you completed this step, OpenAI may be experiencing issues.")]},r=await fetch("/v1/rails/configs",{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok){try{var l,s;let e=await r.json();Object.assign(t,{code:null===(l=e.error)||void 0===l?void 0:l.code,messageLines:[null===(s=e.error)||void 0===s?void 0:s.message]})}catch(e){}g(t);return}let n=await r.json();if(!n){g(t);return}for(let e of n)e.name=e.id,e.maxLength=1e4,e.tokenLimit=1e4;v(n),g(null)},G=e=>{u(e),localStorage.setItem("theme",e)},R=e=>{n(e),localStorage.setItem("apiKey",e)},A=()=>{E(!I),localStorage.setItem("showChatbar",JSON.stringify(!I))},M=()=>{eg()},U=e=>{let{history:t,folders:r}=ef(e);y(t),N(t[t.length-1]),w(r)},F=e=>{N(e),em(e)},J=(e,t)=>{let r={id:(0,ey.Z)(),name:e,type:t},a=[...b,r];w(a),ep(a)},K=e=>{let t=b.filter(t=>t.id!==e);w(t),ep(t);let r=j.map(t=>t.folderId===e?{...t,folderId:null}:t);y(r),eh(r);let a=z.map(t=>t.folderId===e?{...t,folderId:null}:t);D(a),ev(a)},H=(e,t)=>{let r=b.map(r=>r.id===e?{...r,name:t}:r);w(r),ep(r)},$=()=>{let e=j[j.length-1],t={id:(0,ey.Z)(),name:"".concat(a("New Conversation")),messages:[],model:(null==e?void 0:e.model)||f[0],prompt:ed,folderId:null},r=[...j,t];N(t),y(r),em(t),eh(r),c(!1)},W=e=>{let t=j.filter(t=>t.id!==e.id);y(t),eh(t),t.length>0?(N(t[t.length-1]),em(t[t.length-1])):(N({id:(0,ey.Z)(),name:"New conversation",messages:[],model:eo[r],prompt:ed,folderId:null}),localStorage.removeItem("selectedConversation"))},B=(e,t)=>{let r={...e,[t.key]:t.value},{single:a,all:l}=eu(r,j);N(a),y(l)},Y=()=>{y([]),localStorage.removeItem("conversationHistory"),N({id:(0,ey.Z)(),name:"New conversation",messages:[],model:eo[r],prompt:ed,folderId:null}),localStorage.removeItem("selectedConversation");let e=b.filter(e=>"chat"!==e.type);w(e),ep(e)},q=(e,t)=>{if(k){let r=k.messages.map((e,r)=>{if(r<t)return e}).filter(e=>e),a={...k,messages:r},{single:l,all:s}=eu(a,j);N(l),y(s),S(e)}};return(0,i.useEffect)(()=>{C&&(Z(C),S(void 0))},[C]),(0,i.useEffect)(()=>{window.innerWidth<640&&E(!1)},[k]),(0,i.useEffect)(()=>{P(l)},[l]),(0,i.useEffect)(()=>{let e=localStorage.getItem("theme");e&&u(e);let a=localStorage.getItem("apiKey");a?(n(a),P(a)):t&&P(""),window.innerWidth<640&&E(!1);let l=localStorage.getItem("showChatbar");l&&E("true"===l);let s=localStorage.getItem("showPromptbar");s&&_("true"===s);let o=localStorage.getItem("folders");o&&w(JSON.parse(o));let i=localStorage.getItem("prompts");i&&D(JSON.parse(i));let d=localStorage.getItem("conversationHistory");if(d){let e=JSON.parse(d),t=ex(e);y(t)}let c=localStorage.getItem("selectedConversation");if(c){let e=JSON.parse(c),t=ec(e);N(t)}else N({id:(0,ey.Z)(),name:"New conversation",messages:[],model:eo[r],prompt:ed,folderId:null})},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ej(),{children:[(0,s.jsx)("title",{children:"Guardrails Chat"}),(0,s.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,s.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),k&&(0,s.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(x),children:[(0,s.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,s.jsx)(en,{selectedConversation:k,onNewConversation:$})}),(0,s.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[I?(0,s.jsxs)("div",{children:[(0,s.jsx)(es,{loading:m,conversations:j,lightMode:x,selectedConversation:k,apiKey:l,folders:b.filter(e=>"chat"===e.type),onToggleLightMode:G,onCreateFolder:e=>J(e,"chat"),onDeleteFolder:K,onUpdateFolder:H,onNewConversation:$,onSelectConversation:F,onDeleteConversation:W,onToggleSidebar:A,onUpdateConversation:B,onApiKeyChange:R,onClearConversations:Y,onExportConversations:M,onImportConversations:U}),(0,s.jsx)("div",{onClick:A,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]}):(0,s.jsx)("button",{className:"fixed top-2.5 left-4 z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:left-4 sm:h-8 sm:w-8 sm:text-neutral-700",onClick:A,children:(0,s.jsx)(eb.Z,{})}),(0,s.jsx)("div",{className:"flex flex-1",children:(0,s.jsx)(O,{conversations:j,conversation:k,messageIsStreaming:m,apiKey:l,serverSideApiKeyIsSet:t,defaultModelId:r,modelError:p,models:f,loading:d,prompts:z,onSend:Z,onUpdateConversation:B,onEditMessage:q,stopConversationRef:L})}),(0,s.jsx)("div",{})]})]})]})};var eN=!0,eC=ek}},function(e){e.O(0,[879,105,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);
